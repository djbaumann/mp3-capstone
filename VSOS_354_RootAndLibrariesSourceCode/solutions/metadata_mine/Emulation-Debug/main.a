
//_____________________________________________________________
//
	.sect code,ReturnID3	// 675 words
	.export _ReturnID3
_ReturnID3:
	ldc 191,I7
	ldc 15,I5
	ldx (I6)+1,NULL	// I6 += 1
	stx LR0,(I6)+1
	stx I6,(I6) ; sty I4,(I6)
	ldx (I6)*,I4
	stx A0,(I6) ; sty A1,(I6)+1
	stx B0,(I6) ; sty B1,(I6)+1
	stx C0,(I6) ; sty C1,(I6)+1
	stx D0,(I6) ; sty D1,(I6)+1
	stx I0,(I6) ; sty I1,(I6)+1
	ldc InitTemplate_1,I0	// ET0
	stx I2,(I6) ; sty I3,(I6)+1
	stx LC,(I6) ; sty LS,(I6)+1
	ldc 5,LC	// copy 7 words
	stx LE,(I6)+1 ; ldy (I4)*,NULL
	loop LC,MEMCOPY0-1
	ldy (I0)+1,A0
//loop resumes
	sty A0,(I4)+1
	ldy (I0)+1,A0
//	(0 nop's needed)
// loop end
	// memcopy
MEMCOPY0:
	ldc InitTemplate_2,I2	// ET3
	ldc 5,LC	// copy 7 words
	sty A0,(I4)-7
	loop LC,MEMCOPY1-1
	ldx (I4)-6,NULL ; ldy (I2)+1,A0	// ...
//loop resumes
	sty A0,(I4)+1
	ldy (I2)+1,A0
//	(0 nop's needed)
// loop end
	// memcopy
MEMCOPY1:
	ldc InitTemplate_3,I2	// ET7
	sty A0,(I4)-6
// bytesRead
	ldy (I2)+1,A0
	stx A0,(I4)+1 ; ldy (I2)+1,A0
	stx A0,(I4)+1 ; ldy (I2)+1,A0
	stx A0,(I4)+1 ; ldy (I2)+1,A0
	stx A0,(I4)-7 ; and NULL,NULL,A0
	stx A0,(I6)+1 ; ldy (I4)-6,NULL	// ...
	and A,NULL,A	// ETa
// ((*metadata)->fp, 0,0);
	stx A0,(I6)+1	// A0
	stx A1,(I6)+1 ; and NULL,NULL,A1	// A1
	ldx (I4)+2,I3	// unspill 'metadata' from #-2
	ldx (I3),I0	// 'metadata' ==> ETc
	ldx (I0),A0	// ETc ==> ETd
	call _vo_fseek
	stx A0,(I6)	// ETd
// jumped away
	ldc 9,LC	// loop 10 iterations
//     for (i = 0; i < sizeof(common_header); i++)
	loop LC,F0B5-1
	ldx (I6)-4,NULL ; and NULL,NULL,B0	// I6 += -4
//loop resumes
	ldx (I3),I0 ; ldy (I6)+1,NULL	// I6 += 1
//     }
//     {
//         if ((common_header[i] = vo_fgetc((*metadata)->fp)) !=(-1))
	ldx (I0),A0	// ETc ==> ETd
	call _vo_fgetc
	stx A0,(I6)	// ETd
// jumped away
	ldx (I4)+7,NULL ; ldy (I6)-1,NULL	// I4 += 12
	ldx (I4)+5,NULL	// ...
	mv I4,B1	// I4 -> [] -> ET12
	ldx (I4)-7,NULL ; add B1,B0,B1	// I4 += -12
	mv B1,I0	// ATe8 -> ET13
	ldc 65535,B1	// 65535 -> 1 -> ET14
	ldy (I4)-5,NULL ; stx A0,(I0)	// ...
	sub A0,B1,B1	// ET10 ==> ET13
	nop
	jzs F0B9	// unsigned compare
	nop
// jumped away
//         }
//         {
//             bytesRead++;
	sub A1,ONES,A1	// 'bytesRead' - (-1) -> 'bytesRead'
	sub NULL,ONES,B1	// 1 -> 1 -> ET16
F0B9:	// (loop lvl 2)
	sub B0,ONES,B0	// 'i' - (-1) -> 'i'
//	(0 nop's needed)
// loop end
F0B5:	// loop exit
	ldc 73,A0	// 73 -> 1 -> ET1b
	ldx (I4)+7,NULL	// I4 += 12
	ldx (I4)+5,NULL	// ...
//     if ((common_header[0] == 'I') && (common_header[1] == 'D') && (common_header[2] == '3') && (common_header[3] <= 0x04))
	ldx (I4)-7,A1	// I4 ==> ET1a
	ldx (I4)-5,NULL ; sub A1,A0,A1	// ...
	ldc 68,A1	// 68 -> 1 -> ET1f
	jzc F0B12	// unsigned compare
	nop
// jumped away
	ldx (I4)+7,NULL	// I4 += 13
	ldx (I4)+6,NULL	// ...
	ldx (I4)+1,A0	// I4 ==> 1 -> ET1e
	sub A0,A1,A1 ; ldx (I4)-7,A0	// ...
	ldc 51,A1	// 51 -> 1 -> ET23
	jzs F0B15	// unsigned compare
	ldx (I4)-7,NULL
// jumped away
F0B12:
	ldc 2,A0	// 2 -> 0 -> ET20
	ldx (I6)+1,NULL ; or NULL,ONES,A1	// I6 += 1
//     }
// ((*metadata)->fp, -128L,2);
	stx A0,(I6)+1	// ET20
	ldc -128,A0	// -128 -> 2 -> A0
	stx A0,(I6)+1	// -1 -> A1
	stx A1,(I6)+1	// A1
	ldx (I3),I0	// 'metadata' ==> ETc
	ldx (I0),A0	// ETc ==> ETd
	call _vo_fseek
	stx A0,(I6)	// ETd
// jumped away
	ldc 63,I5
	ldy (I4)*,NULL ; ldx (I3),I0	// I4 += 63
	ldc -63,I5
//  vo_fread(raw, 1, 128, (*metadata)->fp);
	ldx (I0),A0 ; ldy (I6)-3,NULL	// ETc ==> ETd
	stx A0,(I6)+1	// ETd
	ldc 128,A0	// 128 -> 1 -> ETa4
	stx A0,(I6)+1 ; sub NULL,ONES,A0	// ETa4
	stx A0,(I6)+1	// ET16
	call _vo_fread
	stx I4,(I6) ; ldy (I4)*,NULL	// ETa5
// jumped away
	ldc 84,A0	// 84 -> 0 -> ETa8
	ldc 63,I5
	ldx (I4)*,NULL ; ldy (I6)-4,NULL	// I4 += 63
	ldc -63,I5
//         if (raw[0] != 'T' || raw[1] != 'A' || raw[2] != 'G')
	ldx (I4)*,A1	// I4 ==> ETa7
	sub A1,A0,A1	// ETa7 != ETa8 -> ATe5
	ldc 65,A0	// 65 -> 0 -> ETab
	jzc F0B131	// signed compare
	nop
// jumped away
	ldc 64,I5
	ldx (I4)*,NULL ; sub NULL,ONES,B0	// I4 += 64
	ldc -64,I5
	ldx (I4)*,A1	// I4 ==> 1 -> ETaa
	sub A1,A0,A1	// ETaa != ETab -> ATe7
	ldc 71,A0	// 71 -> 0 -> ETae
	jzc F0B131	// signed compare
	nop
// jumped away
	ldc 65,I5
	ldx (I4)*,NULL	// I4 += 65
	ldc -65,I5
	ldx (I4)*,A1	// I4 ==> 2 -> ETad
	sub A1,A0,A1	// ETad != ETae -> ATe6
	ldc 30,A0	// 30 -> A0
	jzc F0B131	// signed compare
	nop
// jumped away
	ldc 66,I5
	ldy (I4)*,NULL ; ldx (I3),I0	// I4 += 66
	mv I4,I1	// 'b' -> I1
	ldc -66,I5
//         }

// ((*metadata)->title, b, 30);
	call _memcpy
	ldx (I0)+1,NULL ; ldy (I4)*,NULL	// ET53 += 1
// jumped away
	ldc 32,D0	// 32 -> 1 -> ET56
	ldc 96,I5
	ldy (I4)*,NULL ; ldx (I3),A0	// I4 += 96
//                 b += 30;
//                 memcpy((*metadata)->artist, b, 30);
	ldc -96,I5
	add A0,D0,A0 ; mv I4,I1	// ETc + ET56 -> ET57
	mv A0,I0	// ET57 -> I0
	ldc 30,A0	// 30 -> A0
	call _memcpy
	ldx (I4)*,NULL	// I4 += -96
// jumped away
	ldc 63,A1	// 63 -> 1 -> ET59
	ldc 126,I5
	ldy (I4)*,NULL ; ldx (I3),A0	// I4 += 126
//                 b += 30;
//                 memcpy((*metadata)->album, b, 30);
	ldc -126,I5
	add A0,A1,A0 ; mv I4,I1	// ETc + ET59 -> ET5a
	mv A0,I0	// ET5a -> I0
	ldc 30,A0	// 30 -> A0
	call _memcpy
	ldx (I4)*,NULL	// I4 += -126
// jumped away
F0B1:
	ldx (I6)-1,LE
	ldy (I6),LS ; ldx (I6)-1,LC
	ldy (I6),I3 ; ldx (I6)-1,I2
	ldy (I6),I1 ; ldx (I6)-1,I0
	ldy (I6),D1 ; ldx (I6)-1,D0
	ldy (I6),C1 ; ldx (I6)-1,C0
	ldy (I6),B1 ; ldx (I6)-1,B0
	ldy (I6),A1 ; ldx (I6)-1,A0
	ldx (I4),I6 ; ldy (I4),I4
	ldx (I6)-1,NULL	// I6 += -1
	ldx (I6)-1,LR0
	jr
	nop
// jumped away
F0B131:
	ldc couldnti_5,A0	// ETaf
	ldx (I6)+1,NULL	// I6 += 1
//         }
//         {
//  vo_printf("Couldn't identify ID3v1 tag");
	call _vo_printf
	stx A0,(I6)	// ETaf
// jumped away
//             return;
	j F0B1
	ldx (I6)-1,NULL	// I6 += -1
// jumped away
F0B15:
	sub A0,A1,A1	// ...
	ldc 4,A1	// 4 -> 1 -> ET27
	jzc F0B12	// unsigned compare
	nop
// jumped away
	ldc 15,I5
	ldx (I4)*,NULL	// I4 += 15
	ldc -15,I5
	ldx (I4)*,A0	// I4 ==> 3 -> ET26
	sub A1,A0,B0	// ET27 <= ET26 -> ATc1
	nop
	jcc F0B12	// unsigned compare
	nop
// jumped away
	ldc 7,C0	// 7 -> 0 -> ET2e
	ldc 21,I5
	ldx (I4)*,NULL	// I4 += 21
//     }
// tag_size
	ldc -15,I5
	ldx (I4)-1,B0	// I4 ==> 9 -> ET2a
	ldx (I4)-1,B1	// I4 ==> 8 -> ET2d
	ashl B1,C0,B1	// ET2d << ET2e -> ET2f
	or B0,B1,C0 ; ldx (I4)-1,B1	// ET2a or ET2f -> ET30
	ldc 14,B0	// 14 -> 0 -> ET33
	ashl B1,B0,B0 ; ldx (I4)*,B1	// ET32 << ET33 -> ET34
	or C0,B0,C0	// ET30 or ET34 -> ET35
	ldc 28,B0	// 28 -> 0 -> ET39
	ashl B1,B0,B0	// ET38 << ET39 -> ET3a
	add A1,ONES,B1
	or C0,B0,C0	// ET35 or ET3a -> 'tag_size'
	ldc 10,B0	// 10 -> 'frame_header_size'
	sty C0,(I4) ; stx B0,(I4)-3	// 'tag_size' spills to #0
// = (common_header[3] == 0x03 || common_header[3] == 0x04) ? 10 : 6;
	sub A0,B1,C1	// ET26 == ET3d -> ATc0
	nop
	jzs F0B18	// unsigned compare
	sub A0,A1,C1	// ET26 != ET27 -> ATc5
// jumped away
	nop	// 6 -> 'frame_header_size'
	jzc F0B17	// unsigned compare
	add B1,B1,A0
// jumped away
F0B18:
	ldc 4,A0	// 4 -> 'tagname_size'
	ldc 15,I5
	ldx (I4)*,NULL ; add A0,ONES,A1
//         tagname_size      = (common_header[3] == 0x03 || common_header[3] == 0x04) ?  4 : 3;
	ldx (I4)-7,C1	// I4 ==> 3 -> ET26
	ldx (I4)-6,NULL	// ...
	sty A0,(I4)-2 ; sub C1,A1,A0	// 'tagname_size' spills to #0
	ldc 4,A0	// 4 -> 1 -> ET27
	jzs F0B21	// unsigned compare
	nop
// jumped away
	sub C1,A0,C1 ; ldx (I4)+2,NULL	// ET26 != ET27 -> ATc6
	ldc 3,A0	// 3 -> 'tagname_size'
	jzc F0B20	// unsigned compare
	nop	// I4 += 2
// jumped away
	ldx (I4)-2,NULL
F0B21:
	ldx (I3),I0 ; ldy (I6)+1,NULL	// I6 += 1
//         startingPosition = vo_ftell((*metadata)->fp);
	ldx (I0),A0	// ETc ==> ETd
	call _vo_ftell
	stx A0,(I6)	// ETd
// jumped away
	ldc 2,D1	// 2 -> 1 -> ATf4
	ldc 22,I5
	ldc 32,D0	// 32 -> 1 -> ET56
	ldx (I4)+6,NULL ; ldy (I6)-1,NULL	// I4 += 6
	stx A0,(I4) ; sty A1,(I4)-6	// A0 spills to #0
//         for (tag_loop = 0; tag_loop < 6; tag_loop++)
	ldx (I4)*,NULL ; and NULL,NULL,C1	// 0 -> 'tag_loop'
	ldc -20,I5
	mv I4,A0 ; sub NULL,ONES,B1	// I4 -> [] -> ATf6
	ldx (I4)*,NULL ; and NULL,NULL,A1	// I4 += -20
	ldc 20,I5
	stx A0,(I4)* ; sub NULL,ONES,A0	// ATf6 spills to #0
	ldc -18,I5
	ldx (I4)*,NULL	// 1 -> 1 -> ET16
	ldc 31,I5
	stx A0,(I4) ; sub NULL,ONES,A0	// 0 -> A1
	sty A1,(I4)-3	// A1 spills to #0
	sty A0,(I4)*	// ET1c spills to #0
	mv I4,A0	// I4 -> [] -> ATf5
	ldc -31,I5
	ldx (I4)*,NULL	// I4 += -31
	ldc 31,I5
	stx A0,(I4)*	// ATf5 spills to #0
	ldc -32,I5
	j F0B27
	ldx (I4)*,NULL	// I4 += -32
// jumped away
F0B33:	// (loop lvl 2)
//             switch (tag_loop)
	sub C1,NULL,C1	// 'tag_loop' == (0) -> (0)
	ldc 8,A0	// 8 -> A0
	jzs F0B120	// unsigned compare
	nop
// jumped away
	sub C1,D1,B0	// 'tag_loop' == ATf4 -> ATe3
	nop
	jzs F0B123	// unsigned compare
	nop
// jumped away
	sub C1,B1,B0	// 'tag_loop' != ET16 -> ATe4
	ldc 63,A1	// 63 -> ET59
	jzc F0B26	// unsigned compare
	nop
// jumped away
//                     strncpy((*metadata)->album, "UNKNOWN", 8);
	ldc unknown_4,I1	// I1
	ldx (I3),A0	// 'metadata' ==> ETc
	add A0,A1,A0	// ETc + ET59 -> ET5a
	mv A0,I0	// ET5a -> I0
	call _strncpy
	ldc 8,A0	// 8 -> A0
// jumped away
F0B26:	// (loop lvl 2)
	sub C1,ONES,C1	// 'tag_loop' - (-1) -> 'tag_loop'
F0B27:	// (loop lvl 2)
	ldc 6,A0	// 6 -> ET3e
	sub C1,A0,B0	// 'tag_loop' >= ET3e -> ATc8
	nop	// 3 -> ET3d
	jcs F0B1	// unsigned compare
	nop
// jumped away
	ldc 15,I5
	ldx (I4)*,NULL ; lsr A0,A1
	mv I4,A0	// I4 -> [] -> ET1
	ldc -15,I5
//         }
// compare_tagname
	add A0,C1,A0	// ET1 + 'tag_loop' -> ATe9
	mv A0,I0	// ATe9 -> ET41
	ldy (I0),I2 ; ldx (I4)*,A0	// ET41 ==> 'compare_tagname'
	sub A0,A1,B0	// ET26 == ET3d -> ATc7
	ldc 4,A1	// 4 -> ET27
	jzs F0B29	// unsigned compare
	nop
// jumped away
	sub A0,A1,B0 ; ldx (I4)+7,NULL	// ET26 != ET27 -> ATc9
	ldx (I4)+1,NULL	// ...
	mv I4,A0	// I4 -> [] -> ET4
	ldx (I4)-7,NULL
	jzc F0B28	// unsigned compare
	ldx (I4)-1,NULL
// jumped away
F0B29:	// (loop lvl 2)
	ldx (I4)+6,NULL ; ldy (I6)+1,NULL	// I4 += 6
	ldy (I4),A1 ; and NULL,NULL,A0	// 0 -> ETa
// ((*metadata)->fp, startingPosition,0);
	stx A0,(I6)+1	// ETa
	ldx (I4)-6,A0	// unspill A0 from #0
	stx A0,(I6)+1	// A0
	stx A1,(I6)+1	// A1
	ldx (I3),I0	// 'metadata' ==> ETc
	ldx (I0),A0	// ETc ==> ETd
	call _vo_fseek
	stx A0,(I6)	// ETd
// jumped away
//             while (tag_size)
	j F0B35
	ldx (I6)-4,NULL	// I6 += -4
// jumped away
F0B44:	// (loop lvl 3)
	ldc 3,A1	// 3 -> ET3d
	ldc 15,I5
	ldx (I4)-2,NULL
	ldx (I4)*,NULL	// I4 += 15
//                 if ((common_header[3] == 0x03)||(common_header[3] == 0x04))
	ldc -15,I5
	ldx (I4)*,A0	// I4 ==> 3 -> ET26
	sub A0,A1,B0	// ET26 == ET3d -> ATce
	nop	// 4 -> ET27
	jzs F0B61	// unsigned compare
	sub A1,ONES,A1
// jumped away
	sub A0,A1,B0	// ET26 == ET27 -> ATd4
	ldc 8,A0	// 8 -> ET2b
	jzs F0B61	// unsigned compare
	ldc 27,I5
// jumped away
	ldx (I4)*,NULL	// I4 += 27
//                 else
//                     frame_size = (frame_header[5]) | (frame_header[4] << 8) | (frame_header[3] << 16);
	ldc -25,I5
	ldx (I4)-1,B0	// I4 ==> 5 -> ET64
	ldx (I4)-1,A1	// I4 ==> 4 -> ET6a
	ashl A1,A0,A0 ; ldx (I4)*,NULL	// ET6a << ET2b -> ET6e
	or B0,A0,A1	// ET64 or ET6e -> ET6f
F0B63:	// (loop lvl 3)
	ldc 22,I5
	mv I2,I1 ; and A0,NULL,A0
	or A1,A0,A1 ; ldx (I4)*,NULL	// ET6f or ET72 -> 'frame_size'
	mv I4,I0	// I4 -> [] -> I0
	ldc -20,I5
//                 if (0 == strncmp( (char*) frame_header, compare_tagname, tagname_size))
	ldx (I4)*,NULL	// I4 += -20
	call _strncmp
	ldy (I4)-2,A0	// unspill 'tagname_size' from #0
// jumped away
	sub NULL,A0,B0 ; ldx (I4)+5,NULL	// (0) == ET74 -> ATd5
	nop
	jzs F0B65	// signed compare
	ldy (I6)+1,NULL	// I4 += 5
// jumped away
	stx B0,(I4) ; sty B1,(I4)-4	// B0 spills to #0
//                 }
//                 else
//                 {
//  vo_fseek((*metadata)->fp, frame_size,1);
	ldy (I4)+4,A0 ; and B1,NULL,B1	// unspill ET1c from #0
	stx A0,(I6)+1	// ET1c
	stx A1,(I6)+1
	stx B1,(I6)+1 ; ldy (I4),B1	// B1
	ldx (I3),I0	// 'metadata' ==> ETc
	ldx (I0),A0	// ETc ==> ETd
	stx A0,(I6)	// ETd
	call _vo_fseek
	ldx (I4)-5,B0	// unspill B0 from #0
// jumped away
	ldx (I4)+3,NULL ; ldy (I6)-4,NULL	// I4 += 3
//                     tag_size -= frame_size;
	ldy (I4),A0	// unspill 'tag_size' from #0
	sub A0,A1,A0	// 'tag_size' - 'frame_size' -> 'tag_size'
	sty A0,(I4)-3	// 'tag_size' spills to #0
F0B35:	// (loop lvl 3)
	ldx (I4)+3,NULL	// I4 += 3
	ldy (I4)-3,A0	// unspill 'tag_size' from #0
	sub A0,NULL,A0	// 'tag_size' == (0) -> (0)
	nop
	jzs F0B33	// unsigned compare
	nop
// jumped away
//             }
// fr_hdr_bytes
// (i = 0; i < frame_header_size; i++)
	and NULL,NULL,A1 ; ldx (I4)+3,NULL	// 0 -> 'i'
	ldx (I4)-3,A0 ; and NULL,NULL,B0	// 0 -> 'fr_hdr_bytes'
	sub A1,A0,A0	// 'i' <= 'frame_header_size' -> ATb8
	nop
	jcs F0B37	// unsigned compare
	sub ONES,A0,A0	// (-1) - ATb8 -> ATb8
// jumped away
	loop A0,F0B37-1
	nop
//loop resumes
	ldx (I3),I0 ; ldy (I6)+1,NULL	// I6 += 1
//                 }
//                 {
//                     if ((frame_header[i] = vo_fgetc((*metadata)->fp)) !=(-1))
	ldx (I0),A0	// ETc ==> ETd
	call _vo_fgetc
	stx A0,(I6)	// ETd
// jumped away
	ldc 22,I5
	ldx (I4)*,NULL ; ldy (I6)-1,NULL	// I4 += 22
	ldc -20,I5
	mv I4,A0 ; add A0,NULL,B1	// A0 -> ET48
	ldx (I4)*,NULL	// I4 += -20
	stx A0,(I4)-2 ; add A0,A1,A0	// ATf6 spills to #0
	mv A0,I0	// ATeb -> ET4b
	ldc 65535,A0	// 65535 -> 1 -> ET14
	stx B1,(I0) ; sub B1,A0,A0	// ET48 ==> ET4b
	nop
	jzs F0B41	// unsigned compare
	nop
// jumped away
//                     }
//                     {
//                         fr_hdr_bytes++;
	sub B0,ONES,B0	// 'fr_hdr_bytes' - (-1) -> 'fr_hdr_bytes'
F0B41:	// (loop lvl 4)
	sub A1,ONES,A1	// 'i' - (-1) -> 'i'
	sub NULL,ONES,B1	// 1 -> 1 -> ET16
//	(0 nop's needed)
// loop end
F0B37:	// loop exit
	ldx (I4)+3,NULL	// I4 += 3
//                 tag_size -= fr_hdr_bytes;
	ldy (I4),A0	// unspill 'tag_size' from #0
	sub A0,B0,A0	// 'tag_size' - 'fr_hdr_bytes' -> 'tag_size'
//                 for (i = 0 ; i < tagname_size; i++)
	j F0B46
	sty A0,(I4)-3 ; and NULL,NULL,A0	// 'tag_size' spills to #0
// jumped away
F0B43:	// (loop lvl 4)
//                 }
//                 {
//                     if ((frame_header[i]>'Z')||(frame_header[i]<'0'))
	add A1,A0,A1 ; ldy (I4)-2,NULL	// ATf6 + 'i' -> ATec
	mv A1,I0	// ATec -> ET4b
	ldc 90,A1	// 90 -> ET50
	ldx (I0),B0	// ET4b ==> ET4f
	sub A1,B0,A1	// ET50 > ET4f -> ATcd
	nop
	jcc F0B47	// unsigned compare
	nop
// jumped away
	ldc 48,A1	// 48 -> ET51
	sub B0,A1,B0	// ET4f < ET51 -> ATd1
	nop
	jcc F0B47	// unsigned compare
	nop
// jumped away
	sub A0,ONES,A0	// 'i' - (-1) -> 'i'
F0B46:	// (loop lvl 4)
	ldx (I4)+2,NULL	// I4 += 2
	ldy (I4),A1	// unspill 'tagname_size' from #0
	sub A0,A1,B0 ; ldx (I4),A1	// 'i' < 'tagname_size' -> ATcf
	nop	// unspill ATf6 from #0
	jcc F0B43	// unsigned compare
	nop
// jumped away
	j F0B44
	nop
// jumped away
F0B47:	// (loop lvl 2)
//                     }
//                     {
//                         switch (tag_loop)
	sub C1,NULL,C1	// 'tag_loop' == (0) -> (0)
	nop
	jzs F0B51	// unsigned compare
	nop
// jumped away
	sub C1,D1,B0	// 'tag_loop' == ATf4 -> ATd2
	nop
	jzs F0B55	// unsigned compare
	nop
// jumped away
	sub C1,B1,B0	// 'tag_loop' == ET16 -> ATd3
	ldc 63,A0	// 63 -> ET59
	jzc F0B26	// unsigned compare
	nop
// jumped away
//                                 strcpy((*metadata)->album, "UNKNOWN");
	ldc unknown_4,I1	// I1
	ldx (I3),A1	// 'metadata' ==> ETc
	add A1,A0,A0	// ETc + ET59 -> ET5a
	mv A0,I0	// ET5a -> I0
	call _strcpy
	ldc F0B26,LR0
// jumped away
F0B55:	// (loop lvl 2)
//                                 strcpy((*metadata)->artist, "UNKNOWN");
	ldc unknown_4,I1	// I1
	ldx (I3),A0	// 'metadata' ==> ETc
	add A0,D0,A0	// ETc + ET56 -> ET57
	mv A0,I0	// ET57 -> I0
	call _strcpy
	ldc F0B26,LR0
// jumped away
F0B51:	// (loop lvl 2)
//                                 strcpy((*metadata)->title, "UNKNOWN");
	ldc unknown_4,I1	// I1
	ldx (I3),I0	// 'metadata' ==> ET53
	ldx (I0)+1,NULL	// ET53 += 1
	call _strcpy
	ldc F0B26,LR0
// jumped away
F0B65:	// (loop lvl 3)
	stx B0,(I4) ; sty B1,(I4)-4	// B0 spills to #0
//                 }
//                 {
//  vo_fseek((*metadata)->fp, 1,1);
	ldy (I4)+3,A0	// unspill ET1c from #0
	stx A0,(I6)+1 ; ldy (I4),B1	// ET1c
	ldx (I4)+1,B0	// unspill B0 from #0
	stx B0,(I6)+1	// B0
	stx B1,(I6)+1 ; ldy (I4),B1	// B1
	ldx (I3),I0	// 'metadata' ==> ETc
	ldx (I0),A0	// ETc ==> ETd
	stx A0,(I6)	// ETd
	call _vo_fseek
	ldx (I4)-5,B0	// unspill B0 from #0
// jumped away
	ldc 31,A0	// 31 -> ET77
	sub A0,A1,A0 ; ldx (I6)-4,NULL	// I6 += -4
//                     l_to_read =((frame_size > 31)?(31):(frame_size));
	ldc 31,B0	// 31 -> 'l_to_read'
	jcc F0B71	// unsigned compare
	sub B0,D1,A0
// jumped away
//                     if (l_to_read >= 2)
	sub A1,D1,A0 ; mv A1,B0	// 'l_to_read' >= ATf4 -> ATd7
F0B71:	// (loop lvl 3)
	nop
	jcc F0B35	// unsigned compare
	nop
// jumped away
//                     }
//                     {
//                         for (i = 0; i < 2; i++)
	ldc 1,LC	// loop 2 iterations
	loop LC,F0B75-1
	and NULL,NULL,C0	// 0 -> 'i'
//loop resumes
	ldc 2,D1	// 2 -> 1 -> ATf4
	ldx (I3),I0 ; ldy (I6)+1,NULL	// I6 += 1
//                         }
//                         {
//                             output_str[i] = vo_fgetc((*metadata)->fp);
	ldx (I0),A0	// ETc ==> ETd
	call _vo_fgetc
	stx A0,(I6)	// ETd
// jumped away
	ldc 32,I5
	ldx (I4)*,NULL ; ldy (I6)-1,NULL	// I4 += 32
	ldc -31,I5
	mv I4,A0 ; add A0,NULL,B1	// A0 -> ET79
	ldx (I4)*,NULL	// I4 += -31
	stx A0,(I4)-1 ; add A0,C0,A0	// ATf5 spills to #0
	mv A0,I0 ; sub C0,ONES,C0	// ATed -> ET7c
	stx B1,(I0) ; sub NULL,ONES,B1	// ET79 ==> ET7c
//	(0 nop's needed)
// loop end
F0B75:	// loop exit
	ldc 2,A0	// 2 -> A0
	ldc 24,I5
	ldx (I4)+7,NULL	// I4 += 8
	ldx (I4)+1,NULL	// ...
	mv I4,I0	// I4 -> [] -> I0
//                         if (0 == strncmp(start_utf, output_str, 2))
	ldx (I4)*,NULL	// I4 += 24
	mv I4,I1	// I4 -> [] -> I1
	ldc -32,I5
	call _strncmp
	ldx (I4)*,NULL	// I4 += -32
// jumped away
	sub NULL,A0,A0	// (0) == ET7d -> ATd9
	ldc 3,A0	// 3 -> ET3d
	jzs F0B79	// signed compare
	nop
// jumped away
//                         for (i = 0; i <= l_to_read-2; i++)
	j F0B106
	and NULL,NULL,A1	// 0 -> 'i'
// jumped away
F0B103:	// (loop lvl 3)
//                         }
//                         {
//                             output_str[i+2] = vo_fgetc((*metadata)->fp);
	call _vo_fgetc
	stx A0,(I6)	// ETd
// jumped away
	ldc 32,I5
	ldx (I4)*,NULL ; add A0,NULL,C0	// A0 -> ET90
	ldc -31,I5
	ldc 2,A0	// 2 -> 1 -> ET55
	mv I4,A0 ; add A1,A0,B1	// 'i' + ET55 -> ET92
	ldx (I4)*,NULL ; sub A1,ONES,A1	// I4 += -31
	stx A0,(I4)-1 ; add A0,B1,A0	// ATf5 spills to #0
	mv A0,I0 ; sub NULL,ONES,B1	// ATf2 -> ET93
	stx C0,(I0) ; ldy (I6)-1,NULL	// ET90 ==> ET93
F0B106:	// (loop lvl 3)
	ldc 2,D1	// 2 -> 1 -> ATf4
	sub B0,D1,A0 ; ldx (I3),I0	// 'l_to_read' - ATf4 -> ET8f
	sub A0,A1,A0 ; ldy (I6)+1,NULL	// ET8f <= 'i' -> ATe0
	ldx (I0),A0	// ETc ==> ETd
	jcs F0B103	// unsigned compare
	nop
// jumped away
	ldy (I4)+1,NULL ; ldx (I6)-1,NULL
//                         output_str[l_to_read-1] = 0;
	ldx (I4)-1,A0 ; add B0,ONES,A1	// 'l_to_read' + (-1) -> ET94
	add A0,A1,A0	// ATf5 + ET94 -> ATf1
	mv A0,I0 ; and NULL,NULL,A0	// ATf1 -> ET95
	stx A0,(I0) ; sub C1,NULL,C1	// ET6 ==> ET95
//                         switch (tag_loop)
	nop
	jzs F0B109	// unsigned compare
	nop
// jumped away
	sub C1,D1,B0	// 'tag_loop' == ATf4 -> ATe1
	nop
	jzs F0B112	// unsigned compare
	nop
// jumped away
	sub C1,B1,B0	// 'tag_loop' == ET16 -> ATe2
	ldc 63,A0	// 63 -> ET59
	jzc F0B26	// unsigned compare
	nop
// jumped away
	ldc 32,I5
	ldy (I4)*,NULL ; ldx (I3),A1	// I4 += 32
//                                 strcpy((*metadata)->album, output_str);
	ldc -32,I5
	add A1,A0,A0 ; mv I4,I1	// ETc + ET59 -> ET5a
	mv A0,I0	// ET5a -> I0
	ldx (I4)*,NULL	// I4 += -32
	call _strcpy
	ldc F0B26,LR0
// jumped away
F0B112:	// (loop lvl 2)
	ldc 32,I5
	ldy (I4)*,NULL ; ldx (I3),A0	// I4 += 32
//                                 strcpy((*metadata)->artist, output_str);
	ldc -32,I5
	add A0,D0,A0 ; mv I4,I1	// ETc + ET56 -> ET57
	mv A0,I0	// ET57 -> I0
	ldx (I4)*,NULL	// I4 += -32
	call _strcpy
	ldc F0B26,LR0
// jumped away
F0B109:	// (loop lvl 2)
	ldc 32,I5
	ldy (I4)*,NULL ; ldx (I3),I0	// I4 += 32
	mv I4,I1	// I4 -> [] -> I1
	ldc -32,I5
//                                 strcpy((*metadata)->title, output_str);
	ldx (I0)+1,NULL ; ldy (I4)*,NULL	// ET53 += 1
	call _strcpy
	ldc F0B26,LR0
// jumped away
F0B79:	// (loop lvl 2)
//                         }
//                         {
//                             l_to_read =(((frame_size-3)/2 > 31 -1)?(31 -1):((frame_size-3)/2));
	sub A1,A0,A0	// 'frame_size' - ET3d -> ET80
	ldc -1,A1	// -1 -> AT81
	ashl A0,A1,C0	// ET80 << AT81 -> ET82
	ldc 30,A1	// 30 -> ET7e
	sub A1,C0,A1	// ET7e > ET82 -> ATd8
	ldc 30,B0	// 30 -> 'l_to_read'
	jcc F0B83	// unsigned compare
	and NULL,NULL,A1
// jumped away
	ldc -1,A1	// -1 -> AT83
	ashl A0,A1,B0	// 0 -> 'i'
	sub A1,ONES,A1
//                             for (i = 0; i <= l_to_read; i++)
F0B83:	// (loop lvl 2)
	sub B0,A1,A0	// 'l_to_read' < 'i' -> ATba
	nop
	jcc F0B85	// unsigned compare
	nop
// jumped away
	loop A0,F0B85-1
	nop
//loop resumes
	ldx (I3),I0 ; ldy (I6)+1,NULL	// I6 += 1
//                             }
//                             {
//                                 output_str[i] = vo_fgetc((*metadata)->fp);
	ldx (I0),A0	// ETc ==> ETd
	call _vo_fgetc
	stx A0,(I6)	// ETd
// jumped away
	ldc 27,I5
	ldx (I4)+5,NULL ; add A0,NULL,C0	// I4 += 5
	stx D0,(I4) ; sty D1,(I4)* ; sub NULL,ONES,D0	// D0 spills to #0
	mv I4,B1	// A0 -> ET85
	ldc -31,I5
	ldx (I4)*,NULL ; add B1,A1,A0	// I4 += -31
	mv A0,I2 ; sub NULL,ONES,A0	// ATef -> ET7c
	stx C0,(I2) ; and NULL,NULL,D1	// ET85 ==> ET7c
//  vo_fseek((*metadata)->fp, 1,1);
	sty A0,(I4)+3 ; stx A0,(I6)+1	// ET1c spills to #0
	stx D0,(I4)	// 0 -> D1
	sty D1,(I4)+1 ; stx D0,(I6)+1	// D1 spills to #0
	stx D1,(I6)+1 ; ldy (I4),D1	// D1
	ldx (I3),I0	// 'metadata' ==> ETc
	ldx (I0),A0	// ETc ==> ETd
	stx A0,(I6)	// ETd
	call _vo_fseek
	ldx (I4)-5,D0	// unspill D0 from #0
// jumped away
	ldc 126,C0	// 126 -> 1 -> ET89
	ldx (I2),A0 ; ldy (I6)-4,NULL	// I6 += -4
//                                 if ((output_str[i] > '~' ) || (output_str[i] < ' '))
	sub C0,A0,C0	// ET89 > ET88 -> ATdb
	ldc 32,I5
	jcc F0B90	// unsigned compare
	nop
// jumped away
	ldc 32,D0	// 32 -> 1 -> ET56
	sub A0,D0,A0	// ET88 >= ET56 -> ATdc
	nop
	jcs F0B91	// unsigned compare
	nop
// jumped away
F0B90:	// (loop lvl 3)
	ldx (I4)*,NULL	// I4 += 32
	mv I4,A0	// I4 -> [] -> ET7b
	ldc -32,I5
//                                 }
//                                 {
//                                     output_str[i] = '_';
	ldx (I4)*,NULL ; add A0,A1,B1	// I4 += -32
	mv B1,I0	// ATf0 -> ET7c
	ldc 32,I5
	ldc 95,B1	// 95 -> 1 -> ET8a
	stx B1,(I0)	// ET8a ==> ET7c
F0B91:	// (loop lvl 3)
	ldx (I4)*,NULL ; sub A1,ONES,A1	// I4 += 32
	ldc -31,I5
	mv I4,A0 ; sub NULL,ONES,B1	// I4 -> [] -> ATf5
	ldx (I4)*,NULL	// I4 += -31
	stx A0,(I4)-1	// ATf5 spills to #0
//	(0 nop's needed)
// loop end
F0B85:	// loop exit
	ldx (I4)+1,NULL	// I4 += 1
//                             output_str[l_to_read] = 0;
	ldx (I4)-1,A0	// unspill ATf5 from #0
	add A0,B0,A0	// ATf5 + 'l_to_read' -> ATee
	mv A0,I0 ; and NULL,NULL,A0	// ATee -> ET8b
	stx A0,(I0) ; sub C1,NULL,C1	// ET6 ==> ET8b
//                             switch (tag_loop)
	nop
	jzs F0B94	// unsigned compare
	nop
// jumped away
	sub C1,D1,B0	// 'tag_loop' == ATf4 -> ATdd
	nop
	jzs F0B97	// unsigned compare
	nop
// jumped away
	sub C1,B1,B0	// 'tag_loop' == ET16 -> ATde
	ldc 63,A0	// 63 -> ET59
	jzc F0B26	// unsigned compare
	nop
// jumped away
	ldc 32,I5
	ldy (I4)*,NULL ; ldx (I3),A1	// I4 += 32
//                                     strcpy((*metadata)->album, output_str);
	ldc -32,I5
	add A1,A0,A0 ; mv I4,I1	// ETc + ET59 -> ET5a
	mv A0,I0	// ET5a -> I0
	ldx (I4)*,NULL	// I4 += -32
	call _strcpy
	ldc F0B26,LR0
// jumped away
F0B97:	// (loop lvl 2)
	ldc 32,I5
	ldy (I4)*,NULL ; ldx (I3),A0	// I4 += 32
//                                     strcpy((*metadata)->artist, output_str);
	ldc -32,I5
	add A0,D0,A0 ; mv I4,I1	// ETc + ET56 -> ET57
	mv A0,I0	// ET57 -> I0
	ldx (I4)*,NULL	// I4 += -32
	call _strcpy
	ldc F0B26,LR0
// jumped away
F0B94:	// (loop lvl 2)
	ldc 32,I5
	ldy (I4)*,NULL ; ldx (I3),I0	// I4 += 32
	mv I4,I1	// I4 -> [] -> I1
	ldc -32,I5
//                                     strcpy((*metadata)->title, output_str);
	ldx (I0)+1,NULL ; ldy (I4)*,NULL	// ET53 += 1
	call _strcpy
	ldc F0B26,LR0
// jumped away
F0B61:	// (loop lvl 3)
	ldc 8,A0	// 8 -> ET2b
	ldc 29,I5
	ldx (I4)*,NULL	// I4 += 29
//                     frame_size = (frame_header[7]) | (frame_header[6] << 8) | (frame_header[5] << 16) | ((frame_header[4] << 16) << 16);
	ldc -26,I5
	ldx (I4)-1,A1	// I4 ==> 7 -> ET5d
	ldx (I4)-2,B0	// I4 ==> 6 -> ET5f
	ashl B0,A0,A0 ; ldx (I4)*,NULL	// ET5f << ET2b -> ET60
	or A1,A0,A0	// ET5d or ET60 -> ET61
	ldc 0,A1
	j F0B63
	or A0,A1,A1	// ET61 or ET66 -> ET67
// jumped away
F0B28:	// (loop lvl 2)
	add A0,C1,A0	// I4 += -8
	mv A0,I0	// ATea -> ET44
	j F0B29
	ldy (I0),I2	// ...
// jumped away
F0B123:	// (loop lvl 2)
//                     strncpy((*metadata)->artist, "UNKNOWN", 8);
	ldc unknown_4,I1	// I1
	ldx (I3),A0	// 'metadata' ==> ETc
	add A0,D0,A0	// ETc + ET56 -> ET57
	mv A0,I0	// ET57 -> I0
	ldc 8,A0	// 8 -> A0
	call _strncpy
	ldc F0B26,LR0
// jumped away
F0B120:	// (loop lvl 2)
//                     strncpy((*metadata)->title, "UNKNOWN", 8);
	ldc unknown_4,I1	// I1
	ldx (I3),I0	// 'metadata' ==> ET53
	ldx (I0)+1,NULL	// ET53 += 1
	call _strncpy
	ldc F0B26,LR0
// jumped away
F0B20:
	j F0B21
	sty A0,(I4)-2	// 'tagname_size' spills to #0
// jumped away
F0B17:
	ldx (I4)+3,NULL	// I4 += 3
	j F0B18
	stx A0,(I4)-3	// 'frame_header_size' spills to #0
// jumped away

//_____________________________________________________________
//
	.sect data_x,bss_x	// 0 words
	.export __LINKINFO_DLLENTRY_ReturnID3
__LINKINFO_DLLENTRY_ReturnID3:
	.bss 0

//_____________________________________________________________
//
	.sect data_y,const_y	// 18 words
InitTemplate_1:
	.word String_6, String_7, String_8, String_9, String_10, String_11, String_12
InitTemplate_2:
	.word String_13, String_14, String_15, String_16, String_17, String_18, String_19
InitTemplate_3:
	.word 255, 254
	.zero 1
	.zero 1

//_____________________________________________________________
//
	.sect data_x,const_x	// 99 words
unknown_4:
	.word "UNKNOWN"

	.zero 1
couldnti_5:
	.word "Couldn't identify ID3v1 tag"

	.zero 1
String_6:
	.word "TIT2"

	.zero 1
String_7:
	.word "TALB"

	.zero 1
String_8:
	.word "TPE1"

	.zero 1
String_9:
	.word "TRCK"

	.zero 1
String_10:
	.word "TYER"

	.zero 1
String_11:
	.word "TLEN"

	.zero 1
String_12:
	.word "TIT3"

	.zero 1
String_13:
	.word "TT2"

	.zero 1
String_14:
	.word "TAL"

	.zero 1
String_15:
	.word "TP1"

	.zero 1
String_16:
	.word "TRK"

	.zero 1
String_17:
	.word "TYE"

	.zero 1
String_18:
	.word "TKE"

	.zero 1
String_19:
	.word "TT3"

	.zero 1

	.end
